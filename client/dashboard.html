<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard | AI Powered Personal Finance Tracker</title>

    <!--====== Favicon Icon ======-->
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/svg" />

    <!-- ===== All CSS files ===== -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/animate.css" />
    <link rel="stylesheet" href="assets/css/lineicons.css" />
    <link rel="stylesheet" href="assets/css/ud-styles.css" />
    <link rel="stylesheet" href="assets/css/dashboard.css" />
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <button class="hamburger" onclick="toggleSidebar()">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <h2>Finance Tracker</h2>
    </header>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    <!-- Dashboard Sidebar -->
    <div class="dashboard-sidebar">
        <div class="sidebar-header">
            <div class="user-avatar">
                <i class="lni lni-user"></i>
            </div>
            <div class="user-details">
                <h5>Welcome Back!</h5>
                <p>Manage your finances</p>
            </div>
        </div>

        <nav class="sidebar-menu">
            <a href="#" onclick="showSection('overview')">
                <i class="lni lni-dashboard"></i>
                <span>Overview</span>
            </a>
            <a href="#" onclick="showSection('subscription')">
                <i class="lni lni-crown"></i>
                <span>Subscription</span>
            </a>
            <a href="#" onclick="showSection('banks')">
                <i class="lni lni-credit-cards"></i>
                <span>Bank Accounts</span>
            </a>
            <a href="#" onclick="showSection('analytics')">
                <i class="lni lni-stats-up"></i>
                <span>Analytics</span>
            </a>
            <a href="#" onclick="showSection('budget')">
                <i class="lni lni-wallet"></i>
                <span>Budget</span>
            </a>
            <a href="#" onclick="showSection('ai-chat')">
                <i class="lni lni-consulting"></i>
                <span>AI Assistant</span>
            </a>
            <a href="#" onclick="showSection('settings')">
                <i class="lni lni-cog"></i>
                <span>Settings</span>
            </a>
            <a href="#" onclick="handleLogout()">
                <i class="lni lni-exit"></i>
                <span>Logout</span>
            </a>
        </nav>
    </div>

    <!-- Dashboard Main Content -->
    <div class="dashboard-main">
        <!-- Overview Section -->
        <div id="overview" class="dashboard-section">
            <div class="page-header">
                <h1>Financial Dashboard</h1>
                <p>Follow these steps to get started and unlock the full potential of your AI Finance Tracker</p>
            </div>

            <!-- Onboarding Steps -->
            <div class="onboarding-steps">
                <!-- Step 1: Choose Plan -->
                <div class="step-card" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-header">
                            <i class="lni lni-crown step-icon"></i>
                            <h3>Choose Your Plan</h3>
                        </div>
                        <p>Select the subscription plan that best fits your financial needs and unlock premium features.</p>
                        <div class="step-actions">
                            <button class="btn btn-primary" onclick="showSection('subscription')">
                                <i class="lni lni-arrow-right"></i>
                                View Plans
                            </button>
                        </div>
                    </div>
                    <div class="step-status">
                        <i class="lni lni-checkmark-circle status-icon"></i>
                        <span class="status-text">Available</span>
                    </div>
                </div>

                <!-- Step 2: Connect Bank -->
                <div class="step-card" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-header">
                            <i class="lni lni-credit-cards step-icon"></i>
                            <h3>Connect Your Bank</h3>
                        </div>
                        <p>Securely link your bank accounts to automatically sync transactions and get real-time insights.</p>
                        <div class="step-actions">
                            <button class="btn btn-primary" onclick="showSection('banks')">
                                <i class="lni lni-arrow-right"></i>
                                Connect Bank
                            </button>
                        </div>
                    </div>
                    <div class="step-status">
                        <i class="lni lni-checkmark-circle status-icon"></i>
                        <span class="status-text">Available</span>
                    </div>
                </div>

                <!-- Step 3: View Analytics -->
                <div class="step-card" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-header">
                            <i class="lni lni-stats-up step-icon"></i>
                            <h3>See Your Analytics</h3>
                        </div>
                        <p>Discover spending patterns, track income vs expenses, and get detailed financial insights.</p>
                        <div class="step-actions">
                            <button class="btn btn-primary" onclick="showSection('analytics')">
                                <i class="lni lni-arrow-right"></i>
                                View Analytics
                            </button>
                        </div>
                    </div>
                    <div class="step-status">
                        <i class="lni lni-checkmark-circle status-icon"></i>
                        <span class="status-text">Available</span>
                    </div>
                </div>

                <!-- Step 4: Set Budget -->
                <div class="step-card" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <div class="step-header">
                            <i class="lni lni-wallet step-icon"></i>
                            <h3>Set Spending Limits</h3>
                        </div>
                        <p>Create monthly spending limits for different categories and get notified when you reach them.</p>
                        <div class="step-actions">
                            <button class="btn btn-primary" onclick="showSection('budget')">
                                <i class="lni lni-arrow-right"></i>
                                Set Budget
                            </button>
                        </div>
                    </div>
                    <div class="step-status">
                        <i class="lni lni-checkmark-circle status-icon"></i>
                        <span class="status-text">Available</span>
                    </div>
                </div>

                <!-- Step 5: AI Assistant -->
                <div class="step-card" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <div class="step-header">
                            <i class="lni lni-consulting step-icon"></i>
                            <h3>Chat with AI Assistant</h3>
                        </div>
                        <p>Get personalized financial advice, ask questions about your spending, and receive smart insights.</p>
                        <div class="step-actions">
                            <button class="btn btn-primary" onclick="showSection('ai-chat')">
                                <i class="lni lni-arrow-right"></i>
                                Start Chat
                            </button>
                        </div>
                    </div>
                    <div class="step-status">
                        <i class="lni lni-checkmark-circle status-icon"></i>
                        <span class="status-text">Available</span>
                    </div>
                </div>
            </div>

            <!-- Progress Summary -->
            <div class="progress-summary">
                <div class="progress-card">
                    <div class="progress-header">
                        <h3>Your Progress</h3>
                        <span class="progress-percentage">100%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                    <p class="progress-text">5 of 5 steps available</p>
                </div>
            </div>
        </div>

        <!-- Subscription Section -->
        <div id="subscription" class="dashboard-section">
            <div class="page-header">
                <h1>Subscription Management</h1>
                <p>Choose your plan and manage your subscription</p>
            </div>
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Subscription Plans</h3>
                    <i class="lni lni-crown"></i>
                </div>
                <div class="loading-state">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 text-muted">Loading subscription plans...</p>
                </div>
            </div>
        </div>

        <!-- Bank Accounts Section -->
        <div id="banks" class="dashboard-section">
            <div class="page-header">
                <h1>Bank Accounts</h1>
                <p>Connect and manage your bank accounts securely</p>
            </div>

            <!-- Add Bank Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Connect New Bank</h3>
                    <i class="lni lni-plus"></i>
                </div>
                <div class="bank-connect-content">
                    <p class="text-muted mb-3">Securely connect your bank account to automatically sync transactions and balances.</p>
                    <div class="bank-connect-buttons">
                        <button class="btn btn-primary btn-connect-bank" onclick="connectBank()">
                            <i class="lni lni-credit-cards"></i>
                            Connect Test Account (Sandbox)
                        </button>
                        <button class="btn btn-success btn-connect-real-bank" onclick="connectRealBank()">
                            <i class="lni lni-credit-cards"></i>
                            Connect Real Bank Account
                        </button>
                    </div>
                </div>
            </div>

            <!-- Connected Banks -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Connected Banks</h3>
                    <span class="bank-count">0 </span>
                </div>
                <div id="connected-banks-list" class="banks-list">
                    <div class="empty-state">
                        <i class="lni lni-credit-cards"></i>
                        <h4>No banks connected</h4>
                        <p>Connect your first bank account to get started</p>
                    </div>
                </div>
            </div>

            <!-- Bank Status -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Connection Status</h3>
                    <i class="lni lni-shield"></i>
                </div>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-icon secure">
                            <i class="lni lni-shield"></i>
                        </div>
                        <div class="status-info">
                            <h4>Secure Connection</h4>
                            <p>Bank-level encryption protects your data securely</p>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-icon sync">
                            <i class="lni lni-sync"></i>
                        </div>
                        <div class="status-info">
                            <h4>Auto Sync</h4>
                            <p>Transactions update automatically</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analytics" class="dashboard-section">
            <div class="page-header">
                <h1>Analytics</h1>
                <p>View detailed spending analytics</p>
            </div>
            
            <!-- Analytics Controls -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Analytics Controls</h3>
                    <i class="lni lni-cog"></i>
                </div>
                <div class="analytics-controls">
                    <div class="analytics-controls-row">
                        <div class="control-group">
                            <label for="bankFilter">Bank Filter:</label>
                            <select id="bankFilter" class="form-select" onchange="changeBankFilter()">
                                <option value="all">All Connected Banks</option>
                                <!-- Bank options will be loaded dynamically -->
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="periodFilter">Time Period:</label>
                            <select id="periodFilter" class="form-select" onchange="changePeriodFilter()">
                                <option value="week">This Week</option>
                                <option value="month" selected>This Month</option>
                                <option value="year">This Year</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <button class="btn btn-primary" onclick="refreshAnalytics()">
                                <i class="lni lni-reload"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="row">
                <div class="col-md-3 mb-4">
                    <div class="dashboard-card text-center">
                        <div class="card-header">
                            <h3>Total Income</h3>
                            <i class="lni lni-arrow-up"></i>
                        </div>
                        <div class="balance-amount h2 text-success" id="totalIncome">€0.00</div>
                        <p>From all accounts</p>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="dashboard-card text-center">
                        <div class="card-header">
                            <h3>Total Expenses</h3>
                            <i class="lni lni-arrow-down"></i>
                        </div>
                        <div class="balance-amount h2 text-danger" id="totalExpenses">€0.00</div>
                        <p>From all accounts</p>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="dashboard-card text-center">
                        <div class="card-header">
                            <h3>Net Amount</h3>
                            <i class="lni lni-wallet"></i>
                        </div>
                        <div class="balance-amount h2" id="netAmount">€0.00</div>
                        <p>Income - Expenses</p>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="dashboard-card text-center">
                        <div class="card-header">
                            <h3>Transactions</h3>
                            <i class="lni lni-credit-cards"></i>
                        </div>
                        <div class="balance-amount h2" id="transactionCount">0</div>
                        <p>Total transactions</p>
                    </div>
                </div>
            </div>

            <!-- Top Categories -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Top Spending Categories</h3>
                    <i class="lni lni-pie-chart"></i>
                </div>
                <div id="topCategories" class="categories-list">
                    <div class="empty-state">
                        <i class="lni lni-pie-chart"></i>
                        <h4>No data available</h4>
                        <p>Connect your bank accounts to see spending categories</p>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Recent Transactions</h3>
                    <i class="lni lni-list"></i>
                </div>
                <div id="recentTransactions" class="transactions-list">
                    <div class="empty-state">
                        <i class="lni lni-list"></i>
                        <h4>No transactions found</h4>
                        <p>Connect your bank accounts to see recent transactions</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Budget Section -->
        <div id="budget" class="dashboard-section">
            <div class="page-header">
                <h1>Spending Limits</h1>
                <p>Set monthly spending limits and get notified via email when you reach them</p>
            </div>

            <div class="budget-header">
                <div class="budget-summary">
                    <div class="summary-card">
                        <span class="summary-label">Total Budget</span>
                        <span class="summary-amount" id="totalBudget">€0.00</span>
                    </div>
                    <div class="summary-card">
                        <span class="summary-label">Spent This Month</span>
                        <span class="summary-amount" id="totalSpent">€0.00</span>
                    </div>
                    <div class="summary-card">
                        <span class="summary-label">Remaining</span>
                        <span class="summary-amount" id="totalRemaining">€0.00</span>
                    </div>
                </div>
            </div>

            <div class="budget-alerts" id="budgetAlerts"></div>

            <!-- Add Budget Card -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Set New Spending Limit</h3>
                    <i class="lni lni-plus"></i>
                </div>
                <div class="budget-add-content">
                    <p class="text-muted mb-3">Set spending limits for different categories to track your expenses and get notified via email when you reach your limits.</p>
                                                    <button class="btn btn-primary btn-add-limit" onclick="showBudgetModal()">
                                    <i class="lni lni-plus"></i>
                                    Add New Limit
                                </button>
                </div>
            </div>

            <!-- Budget Categories -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Your Spending Limits</h3>
                    <span class="budget-count">0 </span>
                </div>
                <div class="budget-categories" id="budgetGrid">
                    <div class="empty-state">
                        <i class="lni lni-wallet"></i>
                        <h4>No spending limits set</h4>
                        <p>Set your first spending limit to start tracking</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Budget Modal -->
        <div id="addBudgetModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Set Spending Limit</h3>
                    <span class="close" onclick="budgetManager.closeModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="addBudgetForm">
                        <div class="form-group">
                            <label for="budgetCategory">Category</label>
                            <select id="budgetCategory" required>
                                <option value="">Choose category</option>
                                <option value="Food">Food & Dining</option>
                                <option value="Transport">Transport</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Bills">Bills & Utilities</option>
                                <option value="Shopping">Shopping</option>
                                <option value="Health">Health & Medical</option>
                                <option value="Housing">Housing</option>
                                <option value="Education">Education</option>
                                <option value="Travel">Travel</option>
                                <option value="Insurance">Insurance</option>
                                <option value="Personal Care">Personal Care</option>
                                <option value="Gifts">Gifts</option>
                                <option value="Investments">Investments</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="budgetLimit">Monthly Limit (€)</label>
                            <input type="number" id="budgetLimit" min="0" step="0.01" placeholder="0.00" required>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn-cancel" onclick="budgetManager.closeModal()">Cancel</button>
                            <button type="submit" class="btn-save">Set Limit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- AI Chat Section -->
        <div id="ai-chat" class="dashboard-section">
            <div class="page-header">
                <h1>AI Assistant</h1>
                <p>Chat with AI about your finances</p>
            </div>
            
            <!-- AI Chat Interface -->
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-header-info">
                        <div class="ai-avatar">
                            <i class="lni lni-consulting"></i>
                        </div>
                        <div class="ai-info">
                            <h3>Financial AI Assistant</h3>
                            <span class="status online">Online</span>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="btn-clear-chat" onclick="aiChatManager.clearChat()" title="Clear chat">
                            <i class="lni lni-trash-can"></i>
                        </button>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai-message">
                        <div class="message-avatar">
                            <i class="lni lni-consulting"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-text">
                                Hello! I'm your AI financial assistant. I can help you with:
                                <ul>
                                    <li>Analyzing your spending patterns</li>
                                    <li>Providing budgeting advice</li>
                                    <li>Explaining your financial data</li>
                                    <li>Answering questions about your accounts</li>
                                </ul>
                                How can I help you today?
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea 
                            id="chatInput" 
                            class="chat-input" 
                            placeholder="Ask me about your finances..."
                            rows="1"
                            onkeydown="aiChatManager.handleKeyDown(event)"
                        ></textarea>
                        <button class="send-button" onclick="aiChatManager.sendMessage()" id="sendButton">
                            <i class="lni lni-arrow-right"></i>
                        </button>
                    </div>
                    <div class="chat-suggestions">
                        <button class="suggestion-btn" onclick="aiChatManager.sendSuggestion('How am I spending my money?')">
                            How am I spending my money?
                        </button>
                        <button class="suggestion-btn" onclick="aiChatManager.sendSuggestion('What are my top expenses?')">
                            What are my top expenses?
                        </button>
                        <button class="suggestion-btn" onclick="aiChatManager.sendSuggestion('Give me budgeting tips')">
                            Give me budgeting tips
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="dashboard-section">
            <div class="page-header">
                <h1>Settings</h1>
                <p>Manage your profile and preferences</p>
            </div>
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Profile</h3>
                    <i class="lni lni-user"></i>
                </div>
                <div class="row g-3" style="padding: 0 1rem 1rem;">
                    <div class="col-12 col-md-6">
                        <label class="form-label">Name</label>
                        <input id="settingsName" type="text" class="form-control" placeholder="Your name" />
                    </div>
                    <div class="col-12 col-md-6">
                        <label class="form-label">Email</label>
                        <input id="settingsEmail" type="email" class="form-control" placeholder="you@example.com" disabled />
                    </div>
                    <div class="col-12">
                        <button id="btnSaveProfile" class="btn-add-limit" style="margin-top: 0.5rem;">
                            <i class="lni lni-save"></i> Save Changes
                        </button>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Security</h3>
                    <i class="lni lni-shield"></i>
                </div>
                <div style="padding: 0 1rem 1rem; display: grid; gap: 0.75rem;">
                    <div class="row g-3">
                        <div class="col-12 col-md-4">
                            <p class="text-muted" style="margin-bottom: 0.5rem;">Send password reset code to your email</p>
                            <button id="btnRequestReset" class="btn btn-secondary w-100">
                                <i class="lni lni-key"></i> Send Reset Code
                            </button>
                            <div id="resetStatus" class="form-text" style="margin-top: 0.5rem;"></div>
                        </div>
                        <div class="col-12 col-md-8">
                            <div class="row g-2">
                                <div class="col-12 col-md-4">
                                    <input id="settingsResetCode" type="text" class="form-control" placeholder="Enter code" />
                                    <div id="resetCodeError" class="error-text"></div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <input id="settingsNewPassword" type="password" class="form-control" placeholder="New password" />
                                    <div id="newPasswordError" class="error-text"></div>
                                </div>
                                <div class="col-12 col-md-4">
                                    <input id="settingsConfirmPassword" type="password" class="form-control" placeholder="Confirm password" />
                                    <div id="confirmPasswordError" class="error-text"></div>
                                </div>
                                <div class="col-12">
                                    <button id="btnConfirmReset" class="btn-add-limit">
                                        <i class="lni lni-checkmark"></i> Confirm Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Danger Zone</h3>
                    <i class="lni lni-warning"></i>
                </div>
                <div style="padding: 0 1rem 1rem;">
                    <p class="text-muted" style="margin-bottom: 0.75rem;">Request account deletion. A code will be sent to your registered email. Enter it below to confirm deletion.</p>
                    <div class="row g-2">
                        <div class="col-12 col-md-4">
                            <button id="btnRequestDelete" class="btn btn-danger w-100">
                                <i class="lni lni-trash-can"></i> Send Deletion Code
                            </button>
                            <div id="deleteStatus" class="form-text" style="margin-top: 0.5rem;"></div>
                        </div>
                        <div class="col-12 col-md-5">
                            <input id="settingsDeleteCode" type="text" class="form-control" placeholder="Enter deletion code" />
                            <div id="deleteCodeError" class="error-text"></div>
                        </div>
                        <div class="col-12 col-md-3">
                            <button id="btnConfirmDelete" class="btn btn-outline-danger w-100">
                                <i class="lni lni-checkmark"></i> Confirm Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== All JavaScript files ===== -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/notifications.js"></script>
    <!-- main js -->
    <script src="assets/js/dashboard/dashboard.js?v=1.3"></script>
    <!-- sections js-->
    <script src="assets/js/dashboard/subscription.js"></script>
    <script>
        // Clear any existing duplicate banks on page load
        if (localStorage.getItem('connectedBanks')) {
            const banks = JSON.parse(localStorage.getItem('connectedBanks'));
            const uniqueBanks = banks.filter((bank, index, self) => 
                index === self.findIndex(b => b.id === bank.id)
            );
            localStorage.setItem('connectedBanks', JSON.stringify(uniqueBanks));
        }
        
        // Note: Section switching is now handled by DashboardManager
    </script>
    <script src="assets/js/dashboard/bankManager.js?v=1.5"></script>
    <script src="assets/js/dashboard/analytics.js"></script>
    <script src="assets/js/dashboard/budgetManager.js"></script>
    <script src="assets/js/dashboard/aiChat.js"></script>
    <script src="assets/js/dashboard/settings.js"></script>
</body>
</html>
